<div class="row">
    <div class="col-lg-12">
        <!-- 当前位置提示开始-->
        <div class="page-header title">
            <h1>系统管理 <span class="sub-title">部门管理</span></h1>
        </div>
        <!-- 当前位置提示结束-->
    </div>
</div>
<div class="row">
    <div class="col-lg-12 col-md-12">
        <table class="table table-striped table-bordered">
            <tr>
                <th class="text-center">部门名称</th>
                <th class="text-center">排序</th>
                <th class="text-center">操作</th>
            </tr>
            <% for (var i = 0, l = data.length; i < l; i++) { %>
            <tr data-id="<%= data[i].departmentId %>" isShow="true">
                <td class="text-left name">
                    <% if(data[i].departments.length > 0){ %>
                    <a href="javascript:;" onclick="showAndHideMenu()"><i class="glyphicon glyphicon-minus"></i></a>
                    <% }else{ %>
                    <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                    <% } %>
                    <%= data[i].name %></td>
                <td><p class="text-center"><%= i + 1 %></p></td>
                <td>
                    <div class="text-center">
                        <a href="javascript:;">转移部门</a> |
                        <a href="javascript:;">编辑</a> |
                        <a href="" onclick="removeDepartment(this)" data-toggle="modal"  data-target="#myModal" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% for (var m = 0, n = data[i].departments.length; m < n; m++) { %>
            <tr parent-id="<%= data[i].departments[m].parentId %>" data-id="<%= data[i].departments[m].departmentId %>" isShow="true">
                <td class="name" style="padding-left:2em">
                    <% if(data[i].departments[m].departments.length > 0){ %>
                    <a href="javascript:;" onclick="showAndHideMenu()" data-id="<%= data[i].departments[m].departmentId %>"><i
                                class="glyphicon glyphicon-minus"></i></a>
                    <% }else{ %>
                    <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                    <% } %>
                    <%= data[i].departments[m].name %></td>
                <td class="text-center"></td>
                <td>
                    <div class="text-center">
                        <a href="javascript:;">转移部门</a> |
                        <a href="javascript:;">编辑</a> |
                        <a href="" onclick="removeDepartment(this)" data-toggle="modal"  data-target="#myModal" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% for (var x = 0, y = data[i].departments[m].departments.length; x < y; x++) { %>
            <tr parent-id="<%= data[i].departments[m].departments[x].parentId %>" data-id="<%= data[i].departments[m].departments[x].departmentId %>">
                <td class="name"><p style="padding-left: 4em">
                        <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                        <%= data[i].departments[m].departments[x].name %></p>
                </td>
                <td class="text-left"><%= data[i].departments[m].departments[x].describe %></td>
                <td>
                    <div class="text-center">
                        <a href="javascript:;">转移部门</a> |
                        <a href="javascript:;">编辑</a> |
                        <a href="" onclick="removeDepartment(this)" data-toggle="modal"  data-target="#myModal" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% } %>
            <% } %>
            <% } %>
        </table>
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                                    class="sr-only">Close</span></button>
                    </div>
                    <div class="modal-body">
                        确定要删除该菜单吗?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" onclick="removeDepartmentById()" id="remove">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    td {
        vertical-align: middle !important;
    }

    td > * {
        margin: 8px !important;
    }

    td.name {
        cursor: pointer;
    }

    .hide {
        display: none !important;
    }
</style>
<script src="/assets/js/jquery.min.js"></script>
<script>
var removeDepartmentId
    function showAndHideMenu(e) {
        e = e || window.event;
        e.stopPropagation;
        e.defaultPrevented;
        var departmentId = $(e.target).eq(0).parent().parent().parent().data("id");
        $("tr[parent-id='" + departmentId + "']").toggleClass("hide");
        var menuArr = $("tr[parent-id='" + departmentId + "']");
        show_hide(menuArr)
        $(e.target).toggleClass("glyphicon-minus glyphicon-plus");
    }
    function show_hide(arr) {

        for (var i = 0, l = arr.length; i < l; i++) {
            var departmentId = arr.eq(i).data("id");
            $("tr[parent-id='" + departmentId + "']").toggleClass("hide");
            var menuArr = $("tr[parent-id='" + departmentId + "']");
            $(arr.eq(i)).find("i").toggleClass("glyphicon-minus glyphicon-plus");
            show_hide(menuArr)
        }
    }
    function removeDepartment(dom) {
        removeDepartmentId = $(dom).parent().parent().parent().data('id');

    }
    function removeDepartmentById() {
        $.ajax({
            url: "/department/remove?id=" + removeDepartmentId,
            method: "get",
            type: "json",
            success: function (data) {
                data=JSON.parse(data);
                if (data.status == 1) {
                    location.reload();
                    $("#myModal").css({"display": "block", "opacity": 0})
                }
            }

        })
    }
</script>