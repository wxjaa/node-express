<div class="row">
    <div class="col-lg-12">
        <!-- 当前位置提示开始-->
        <div class="page-header title" style="position: relative">
            <h1>系统管理 <span class="sub-title">菜单管理</span></h1>
            <button class="btn btn-info" onclick="location.href='/addMenu'"
                    style="position: absolute;right:30px;top: 50%;margin-top: -17px;">添加菜单
            </button>
        </div>
        <!-- 当前位置提示结束-->
    </div>
</div>
<div class="row">
    <div class="col-lg-12 col-md-12">
        <table class="table table-striped table-bordered">
            <tr>
                <th class="text-center">菜单名称</th>
                <th class="text-center">菜单描述</th>
                <th class="text-center">菜单图标</th>
                <th class="text-center">排序</th>
                <th class="text-center">是否显示</th>
                <th class="text-center">操作</th>
            </tr>
            <% for (var i = 0, l = data.length; i < l; i++) { %>
            <tr data-id="<%= data[i].menuId %>" isShow="true">
                <td class="text-left name">
                    <% if(data[i].menus.length > 0){ %>
                    <a href="javascript:" onclick="showAndHideMenu()"><i class="glyphicon glyphicon-minus"></i></a>
                    <% }else{ %>
                    <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                    <% } %>
                    <%= data[i].name %></td>
                <td class="text-left"><%= data[i].describe %></td>
                <td class="text-center"></td>
                <td><p class="text-center"><%= i + 1 %></p></td>
                <% if(data[i].isDisplay == 1){ %>
                <td><p class="text-center">是</p></td>
                <% }else{ %>
                <td><p class="text-center">否</p></td>
                <% } %>
                <td>
                    <div class="text-center">
                        <a href="javascript:">转移菜单</a> |
                        <a href="javascript:">编辑</a> |
                        <a href="javascript:" onclick="listTable.remove(12, '您确认要删除这条记录吗?')" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% for (var m = 0, n = data[i].menus.length; m < n; m++) { %>
            <tr parent-id="<%= data[i].menus[m].parentId %>" data-id="<%= data[i].menus[m].menuId %>" isShow="true">
                <td class="name" style="padding-left:2em">
                    <% if(data[i].menus[m].menus.length > 0){ %>
                    <a href="javascript:" onclick="showAndHideMenu()" data-id="<%= data[i].menus[m].menuId %>"><i
                                class="glyphicon glyphicon-minus"></i></a>
                    <% }else{ %>
                    <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                    <% } %>
                    <%= data[i].menus[m].name %></td>
                <td class="text-left"><%= data[i].menus[m].describe %></td>
                <td class="text-center"></td>
                <td><p class="text-center"><%= i + 1 %></p></td>
                <% if(data[i].menus[m].isDisplay == 1){ %>
                <td><p class="text-center">是</p></td>
                <% }else{ %>
                <td><p class="text-center">否</p></td>
                <% } %>
                <td>
                    <div class="text-center">
                        <a href="javascript:">转移菜单</a> |
                        <a href="javascript:">编辑</a> |
                        <a href="javascript:" onclick="listTable.remove(12, '您确认要删除这条记录吗?')" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% for (var x = 0, y = data[i].menus[m].menus.length; x < y; x++) { %>
            <tr parent-id="<%= data[i].menus[m].menus[x].parentId %>" data-id="<%= data[i].menus[m].menus[x].menuId %>">
                <td class="name"><p style="padding-left: 4em">
                        <i class="glyphicon glyphicon-minus" style="color:#f5f5f5"></i>
                        <%= data[i].menus[m].menus[x].name %></p>
                </td>
                <td class="text-left"><%= data[i].menus[m].menus[x].describe %></td>
                <td class="text-center"></td>
                <td><p class="text-center"><%= x + 1 %></p></td>
                <% if(data[i].menus[m].menus[x].isDisplay == 1){ %>
                <td><p class="text-center">是</p></td>
                <% }else{ %>
                <td><p class="text-center">否</p></td>
                <% } %>
                <td>
                    <div class="text-center">
                        <a href="javascript:">转移菜单</a> |
                        <a href="javascript:">编辑</a> |
                        <a href="javascript:" onclick="removeMenu(this)" title="移除">移除</a>
                    </div>
                </td>
            </tr>
            <% } %>
            <% } %>
            <% } %>
        </table>
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#menu">
            添加菜单
        </button>
        <!--<a href="#" id="id-btn-dialog1" class="btn btn-primary" >部门管理</a>-->
        <!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" id="id-btn-dialog1">-->
        <!-- Modal -->
        <div class="modal fade" id="menu" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" id="menu-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                                    class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">添加菜单</h4>
                    </div>
                    <div class="modal-body">
                        <div class="input-group col-lg-6">
                            <span class="input-group-addon">菜单名称:</span>
                            <input type="text" id="menuName" class="form-control ">
                        </div>
                        <div class="col-lg-6 input-group">
                            <span class="checkbox">是否显示：
                                <label>
                                    <input type="radio" class="isDisplay" value="true" checked="checked"
                                           name="isDisplay"> 是
                                </label>
                                <label>
                                    <input type="radio" class="isDisplay" value="false" name="isDisplay"> 否
                                </label>
                            </span>
                            <!-- <span>是否显示：<span>是：<input type="checkbox"><span>否：<input
                                                 type="checkbox"></span></span></span>-->
                        </div>
                        <div class="input-group col-lg-6" style="margin-bottom: 0.5em">
                            <span class="input-group-addon">菜单排序:</span>
                            <input type="text" id="menuSort" class="form-control">
                        </div>
                        <!-- /btn-group -->
                        <div class="input-group-btn">
                            <button type="button" id="parentMenu" style="min-width: 12.2em;text-align: center;"
                                    class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                顶级菜单
                                <span class="caret"></span>
                            </button>
                            <ul style="min-width: 13.16em;text-align: center" class="dropdown-menu" role="menu"
                                aria-labelledby="dropdownMenu1">
                                <li role="presentation" class="menuLi" data-id="">
                                    <a role="menuitem" tabindex="-1" href="#">顶级菜单</a></li>
                                <% for (var i = 0, l = data.length; i < l; i++) { %>
                                <li role="presentation" class="menuLi"
                                    data-id="<%= data[i].menuId %>">
                                    <a role="menuitem" tabindex="-1" href="#"><%= data[i].name %></a></li>
                                <% for (var m = 0, n = data[i].menus.length; m < n; m++) { %>
                                <li role="presentation" class="menuLi"
                                    data-id="<%= data[i].menus[m].menuId %>">
                                    <a role="menuitem" tabindex="-1"
                                       href="#"><%= data[i].menus[m].name %></a>
                                </li>
                                <% for (var x = 0, y = data[i].menus[m].menus.length; x < y; x++) { %>
                                <li role="presentation" class="menuLi"
                                    data-id="<%= data[i].menus[m].menus[x].menuId %>">
                                    <a role="menuitem" tabindex="-1"
                                       href="#"><%= data[i].menus[m].menus[x].name %></a>
                                </li>
                                <% } %>
                                <% } %>
                                <% } %>
                            </ul>
                        </div>
                        <!-- /btn-group -->
                        <div class="input-group col-lg-2" style="margin-bottom: 0.5em;margin-top: 0.5em">
                            <span class="input-group-addon">菜单描述:</span>
                        </div>
                        <textarea name="MSG" id="menuDescribe" cols=77 rows=4 style="max-width: 100%;"></textarea>

                        <div class="input-group" style="margin-top: 0.5em">
                            <span class="input-group-addon">访问地址:</span>
                            <input class="form-control" id="menuUrl" type="text">
                        </div>
                        <div class="input-group col-lg-12"
                             style="margin-top: 0.5em;margin-bottom: 0.5em;margin-top: 0.5em">
                            <span class="input-group-addon">选择图标:</span>
                        </div>
                        <div class="input-group col-lg-12" style="margin-top: 0.5em">
                            <button type="button" class="btn  btn-lg icon_li sel" data-toggle="modal"
                                    id="icon_li01">
                            </button>
                            <button type="button" class="btn btn-lg icon_li" data-toggle="modal"
                                    id="icon_li02">
                            </button>
                            <button type="button" class="btn btn-lg icon_li" data-toggle="modal"
                                    id="icon_li03">
                            </button>
                            <button type="button" class="btn  btn-lg icon_li" data-toggle="modal"
                                    id="icon_li04">
                            </button>
                            <button type="button" class="btn  btn-lg icon_li" data-toggle="modal"
                                    id="icon_li05">
                            </button>
                            <button type="button" class="btn  btn-lg icon_li" data-toggle="modal"
                                    id="icon_li06">
                            </button>
                            <button type="button" class="btn  btn-lg icon_li" data-toggle="modal"
                                    id="icon_li07">
                            </button>
                            <button type="button" class="btn btn-lg icon_li" data-toggle="modal"
                                    id="icon_li08">
                            </button>
                            <button type="button" class="btn btn-lg icon_li" data-toggle="modal"
                                    id="icon_li09">
                            </button>
                            <button type="button" class="btn btn-lg icon_li" data-toggle="modal"
                                    id="icon_li10">
                            </button>
                            <!--<div id="icon" style="border-radius: 100%;margin-left: 1em;height: 2.5em;width: 2.5em;background-image: url:("../../assets/images/user.jpg") >请选择</div>-->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="addMenu">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    td {
        vertical-align: middle !important;
    }

    td > * {
        margin: 8px !important;
    }

    td.name {
        cursor: pointer;
    }

    .dl-horizontal dt {
    }

    .hide {
        display: none !important;
    }

    dl dt:lang(dtmt) {
        margin-top: 0.6em;
    }

    .icon_li {
        background-repeat: no-repeat;
        background-size: cover;
        border-radius: 100%;
        margin-top: 0.5em;
        margin-left: 1em;
        height: 2.5em;
        width: 2.5em;
        border-color: #009cff;
        background-image: url(../../assets/images/user.jpg);
    }

    .icon_li.sel {
        border-color: red;
    }

    dl dd {
        margin-top: 0.4em;
    }
</style>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/plugins/jqueryui/jquery-ui.min.js"></script>
<script src="/assets/js/plugins/jqueryui/jquery-ui.init.js"></script>

<script>
    var icon = "icon_li01";
    function showAndHideMenu(e) {
        e = e || window.event;
        e.stopPropagation;
        e.defaultPrevented;
        var menuId = $(e.target).eq(0).parent().parent().parent().data("id");
        $("tr[parent-id='" + menuId + "']").toggleClass("hide");
        var menuArr = $("tr[parent-id='" + menuId + "']");
        show_hide(menuArr);
        $(e.target).toggleClass("glyphicon-minus glyphicon-plus");
    }
    function show_hide(arr) {

        for (var i = 0, l = arr.length; i < l; i++) {
            var menuId = arr.eq(i).data("id");
            $("tr[parent-id='" + menuId + "']").toggleClass("hide");
            var menuArr = $("tr[parent-id='" + menuId + "']");
            $(arr.eq(i)).find("i").toggleClass("glyphicon-minus glyphicon-plus");
            show_hide(menuArr)
        }
    }

    $(function () {
        $('#menu-content').draggable();
        $('#management-content').draggable();
    });

    var parentDepartmentId = null;
    $(".menuLi").click(function (e) {
        e.stopPropagation;
        e.preventDefault;
        var name = $(this).find("a").html();
        var departmentId = $(this).data('id');
        parentDepartmentId = departmentId || null;
        $("#parentMenu").html(name + '<span class="caret"></span>');
    });
    $("#addMenu").click(function () {
        var name = $("#menuName").val();
        var describe = $("#menuDescribe").val();
        var menuUrl = $("#menuUrl").val();
        var isDisplay = $(".isDisplay:checked").val();
        if (!name) {
            alert("请输入菜单名称");
            return;
        }
        var sort = $("#menuSort").val();
        if (!sort) {
            sort = 0;
        }
        console.log({
            "name": name,
            "parentId": parentDepartmentId,
            "sort": sort,
            "icon": icon,
            "describe": describe,
            "url": menuUrl,
            "isDisplay": isDisplay
        })
        $.ajax({
            url: "/menu/addMenu",
            type: "json",
            method: "post",
            data: {
                "name": name,
                "parentId": parentDepartmentId,
                "sort": sort,
                "icon": icon,
                "describe": describe,
                "url": menuUrl,
                "isDisplay": isDisplay
            },
            success: function (data) {
                data = JSON.parse(data);
                if (data.state == 1) {
                    alert("添加成功");
                    $("#management").hide();
                    location.reload();
                } else {
                    alert("添加失败");
                }
            }
        })
    })

    $(".icon_li").click(function (e) {
        e.preventDefault;
        $(this).addClass("sel").siblings().removeClass("sel");
        icon = $(this).attr(id);
    })
</script>