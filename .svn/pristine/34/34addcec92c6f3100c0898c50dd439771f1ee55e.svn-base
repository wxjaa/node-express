const cache = require('./cache.js');
const co = require("co");
const db = require('./db.js');
function render(param) {
    return new Promise(function (resolve, reject) {
        co(function *() {
            var menu = yield cache.getCache("menu");
            if (!menu) {
                menu = yield db.menu.all({
                    where: {
                        parentId: null
                    },
                    include: [
                        {
                            model: db.menu,
                            required: false,
                            order: [['sort', 'ASC']],
                            include: [
                                {
                                    model: db.menu,
                                    required: false,
                                    order: [['sort', 'ASC']],
                                    include: [
                                        {
                                            model: db.menu,
                                            required: false,
                                            order: [['sort', 'ASC']],
                                            include: [
                                                {
                                                    model: db.menu,
                                                    required: false,
                                                    order: [['sort', 'ASC']]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    order: [['sort', 'ASC']]
                });
                yield cache.setCache("menu", menu);
            }
            param.menu = menu;
            resolve(param);
        }).catch(function (err) {
                reject(err);
            }
        );
    });
}

module.exports.render = render;